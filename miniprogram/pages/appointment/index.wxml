<!--pages/appointment/index.wxml-->
<wxs module="dateStylish">
  module.exports = {
    style: function (id, selected) {
      if (id == selected) {
        if (id === 0) {
          return 'background: #749b15;color:#fff;border-top-left-radius:6rpx;border-bottom-left-radius:6rpx;'
        } else if (id === 6) {
          return 'background: #749b15;color:#fff;border-top-right-radius:6rpx;border-bottom-right-radius:6rpx;'
        } else {
          return 'background: #749b15;color:#fff;';
        }
      } else if (id === 6) {
        return 'background: #f3f3f3; border-top-right-radius:6rpx;border-bottom-right-radius:6rpx;'
      } else {
        return 'background:#f3f3f3;';
      }
    },
    thumbnail: function (courseName) {
      if (courseName === "普拉提") {
        return "../../images/pilates.jpg";
      } else if (courseName === "优雅仪态") {
        return "../../images/elegant-demeanor.jpg";
      }
      return "../../images/elegant-demeanor.jpg";

    },
    format: function (ms) {
      var date = getDate(ms );
      var month = date.getMonth() + 1;
      var day = date.getDate();
      return date.getFullYear() + "-" + (month >= 10 ? month : '0' + month) + "-" + (day >= 10 ? day : '0' + day);
    }
  }
</wxs>

<view class="tabs">
  <view class="tabs__nav">
    <view class="tab  tab-daily-schedule {{dayScheduleActivated?'tab--active':''}}" bindtap="clickDaySchedule">
      <view class="tab__text">
        日课表
      </view>
    </view>
    <view class="tab tab-monthly-schedule" bindtap="clickMonthlySchedule">
      <view class="tab__text">
        月课表
      </view>
    </view>


    <view class="tabs__line" style="transform: translateX({{offset}}px) translateX(-50%);">
    </view>
  </view>
</view>

<block wx:if="{{dayScheduleActivated}}">
  <view class="daily-schedule">
    <view class="daily-schedule-item" style="{{dateStylish.style(item.id,selected)}}" bindtap="onDateTap" data-time="{{item.time}}" wx:for="{{dates}}" wx:key="id" data-id="{{item.id}}">
      <text>{{item.week}}</text>
      <text class="daily-schedule-day">{{item.day}}</text>
      <text>{{item.month+1}}月</text>
    </view>
  </view>
  <view class="space"></view>
  <view class="course" wx:for="{{courses}}" wx:key="_id">
    <view class="left">
      <text>{{item.startTime}}-{{item.endTime}}</text>
      <text class="course-name">{{item.courseName}}</text>
      <text>{{item.teacher}}</text>
      <text wx:if="{{!item.disable}}">还可以预约 {{item.peoples}} 人</text>
    </view>
    <view class="right">
      <image class="thumbnail" src="https://static.lucidu.cn/images/{{item.image}}"></image>
      <button wx:if="{{item.disable}}" class="reserve-disable">已过期</button>
      <button wx:elif="{{!item.disable && !item.reserved}}" data-id="{{item.id}}" data-time="{{item.dateTime}}" class="reserve" bindtap="bookCourse">预约</button>
      <button wx:elif="{{item.reserved}}" data-id="{{item.reservedId}}" data-time="{{item.dateTime}}" class="reserve" bindtap="deleteCourse">已预约</button>
    </view>
  </view>
</block>
<block wx:else>
  <view class="course" wx:for="{{coursesMonth}}" wx:key="id">
    <view class="left">
      <text>{{dateStylish.format(item.dateTime)}}</text>
      <text>{{item.startTime}}-{{item.endTime}}</text>
      <text class="course-name">{{item.courseName}}</text>
      <text>{{item.teacher}}</text>
      
    </view>
    <view class="right">
      <image class="thumbnail" src="https://static.lucidu.cn/images/{{item.image}}"></image>
      <button wx:if="{{item.disable}}" class="reserve-disable">已过期</button>
      <button wx:elif="{{!item.disable && !item.reserved}}" data-id="{{item.id}}" data-time="{{item.dateTime}}" class="reserve" bindtap="bookCourse">预约</button>
      <button wx:elif="{{item.reserved}}" data-id="{{item.reservedId}}" data-time="{{item.dateTime}}" class="reserve" bindtap="deleteCourse">已预约</button>
    </view>
  </view>
</block>

<view wx:if="{{!hideDialog}}">
  <view class="overlay" bindtap="closeDialog"></view>
  <view class="dialog">
    <view class="dialog__header">
      询问
    </view>

    <view class="dialog__content">
      <view class="dialog__message">您确定要取消预约吗？</view>
    </view>

    <view class="dialog__footer dialog__border dialog__border--top">
      <view class="dialog__button dialog__confirm dialog__border dialog__border--right" bindtap="confirmDialog" data-id="{{selectedId}}">
        <view class="button__content">确定</view>
      </view>
      <view class="dialog__button dialog__close" bindtap="closeDialog">
        <view class="button__content">取消</view>
      </view>
    </view>


  </view>
</view>
